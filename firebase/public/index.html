<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>
    <script src="mailcheck.js"></script>
    <title>Mailcheck</title>
</head>

<body>
<div class="container">
    <h1>Mailcheck</h1>
    <p>For a demo, enter a@hotmale.com or b@gmail.co in the field below:</p>
    <form>
        <div class="row">
            <div class="col-sm form-group">
                <label for="domains">Známé mailové domény</label>
                <textarea class="form-control" id="domains" aria-describedby="domainsHelp" rows="5"></textarea>
                <small id="domainsHelp" class="form-text text-muted">E-mailové domény (např. seznam.cz), každý na jeden
                    řádek</small>
            </div>
            <div class="col-sm form-group">
                <label for="multidomains">Známé multidoménové služby</label>
                <textarea class="form-control" id="multidomains" aria-describedby="multidomainsHelp" rows="5"></textarea>
                <small id="multidomainsHelp" class="form-text text-muted">Služby, které jsou provozovány na více TLD, zapisujte bez TLD (např. google), každá na jeden řádek</small>
            </div>
            <div class="col-sm form-group">
                <label for="tld">Známé TLD</label>
                <textarea class="form-control" id="tld" aria-describedby="tldHelp" rows="5"></textarea>
                <small id="tldHelp" class="form-text text-muted">Seznam TLD (domény prvního řádu), zapisujte bez úvodní tečky, každý na nový řádek</small>
            </div>
        </div>
        <div class="form-group">
            <label for="email">E-maily ke kontrole</label>
            <textarea class="form-control" id="email" aria-describedby="emailHelp" autofocus></textarea>
            <small id="emailHelp" class="form-text text-muted">Každý na jeden řádek</small>
        </div>
        <button id="go" class="btn btn-primary">Zkontrolovat</button>
    </form>

    <table id="suggestion" class="table">
        <thead>
        <tr>
            <th scope="col">E-mail</th>
            <th scope="col">OK?</th>
            <th scope="col">Návrh</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<script>
    const el = {
        'domains': null,
        'multidomains': null,
        'tld': null,
        'email': null,
        'result': null,
        'button': null,
    };

    $(init);

    function init() {
        el.domains = document.querySelector('#domains');
        el.multidomains = document.querySelector('#multidomains');
        el.tld = document.querySelector('#tld');
        el.email = document.querySelector('#email');
        el.result = document.querySelector('#suggestion tbody');
        el.button = document.querySelector('#go');

        el.domains.value = Mailcheck.defaultDomains.join("\n");
        el.multidomains.value = Mailcheck.defaultSecondLevelDomains.join("\n");
        el.tld.value = Mailcheck.defaultTopLevelDomains.join("\n");

        $(el.button).on('click', (event) => {
            event.preventDefault();
            check();
        });
    }

    function check() {
        const trim = (str) => str.trim();
        const filled = (str) => str !== '';

        $(el.result).empty();
        const emails = el.email.value.split('\n').map(trim).filter(filled);
        const domains = el.domains.value.split('\n').map(trim).filter(filled);
        const multidomains = el.multidomains.value.split('\n').map(trim).filter(filled);
        const tld = el.tld.value.split('\n').map(trim).filter(filled);

        emails.forEach((email) => {
            const result = Mailcheck.run({
                email: email,
                domains: domains,
                secondLevelDomains: multidomains,
                topLevelDomains: tld,
            });

            const status = !result ? "OK" : "Návrh:";
            const suggest = result ? result.full : '';

            addResult(email, status, suggest)
        });
    }

    function addResult(email, status, suggestion) {
        const row = document.createElement('tr');

        for (const val of [email, status, suggestion]) {
            const col = document.createElement('td');
            col.textContent = val;
            row.append(col);
        }

        el.result.append(row);
    }
</script>
</body>

